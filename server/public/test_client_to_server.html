<!doctype html>
<html>
  <head>
    <title>Test Client</title>
    <meta charset="utf-8">
	<script src="jquery-1.11.3.min.js"></script>
	<script src="binary.js"></script>

  </head>
  <body style="background-size:cover">

  <input type="button" value="Start!" id="start" />
  <input type="button" value="Join!" id="disp" />
  <input type="file" id="fileinput" accept="image/*" capture="camera" />

  <div id="div" style="display:none;background-image:url(http://www.betriebsausstatter24.de/media/catalog/product/cache/1/image/370x/9df78eab33525d08d6e5fb8d27136e95/5/0/50025_3_57.jpg); background-repeat:no-repeat;height:400px;">
  <p>Input the other's ID:</p>
  <input type="number" placeholder="000000" min = "000000" max = "999999" id="new_id" style="width:65px;height:20px;"/>
  <input type="button" value="Submit" id="join" />
  </div>

  <p id="message" style ="background-color:#ffffff;"></p>

  
	<script>
		// connect to the same host this was served from
    var client = new BinaryClient('ws://localhost:5000/binary-endpoint');
		console.log(client);

    client.on('stream', function(stream, meta){
      // collect stream data
      var parts = [];
      stream.on('data', function(data){
        parts.push(data);
      });
      // when finished, set it as the background image
      stream.on('end', function(){
        var url = (window.URL || window.webkitURL).createObjectURL(new Blob(parts));
        document.body.style.backgroundImage = 'url(' + url + ')';
      });
    });
    // listen for a file being chosen
    fileinput.addEventListener('change', function(event){
        var file = event.target.files[0];
        client.send(file);
    }, false);

	$("#start").click(function() {
		$.post('http://localhost:5000/action', { action: "start" },function(id){
			$("#message").text("you ID is " + id);
		});
	});
	
	$("#disp").on("click", function() {
		$( "#div" ).slideDown( "slow", function() {
    	// Animation complete.
  		});
	});
	
	$("#join").click(function() {
		var new_id = $("#new_id").val();
		if(new_id!=""){
			$("#message").text("you entered " + new_id);
			$.post('http://localhost:5000/action', { action: "join" , id: new_id} ,function(res){
				alert(res);
			});
		}
	});
	</script>
  </body>
